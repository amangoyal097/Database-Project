CREATE DATABASE IF NOT EXISTS Test7;
USE Test7;
CREATE TABLE IF NOT EXISTS SELLER(Name varchar(100) NOT NULL,MobileNo varchar(10) NOT NULL UNIQUE,Email varchar(100) NOT NULL UNIQUE,Address varchar(100) NOT NULL UNIQUE,SellerID INT NOT NULL AUTO_INCREMENT,CHECK (MobileNo RLIKE '^[0-9]{10}$'),CHECK (Email RLIKE '^(?=[A-Z0-9][A-Z0-9@.%+-]{5,253}+$)[A-Z0-9.%+-]{1,64}+@(?:(?=[A-Z0-9-]{1,63}+\.)[A-Z0-9]++(?:-[A-Z0-9]++)*+\.){1,8}+[A-Z]{2,63}+$'),PRIMARY KEY(SellerId));
CREATE TABLE IF NOT EXISTS PROPERTY(SellerId INT NOT NULL,PropertyNo varchar(100) NOT NULL,StreetAddress varchar(100) NOT NULL UNIQUE,AvailableFrom DATE NOT NULL,FacingDirection varchar(6) NOT NULL,Cost INT NOT NULL,PropertyID INT NOT NULL AUTO_INCREMENT,CHECK (FacingDirection IN ('North','South','West','East','north','south','west','east')),PRIMARY KEY (PropertyID) ,FOREIGN KEY (SellerID) REFERENCES SELLER(SellerID) ON DELETE CASCADE ON UPDATE CASCADE);
CREATE TABLE IF NOT EXISTS AGENT(Name VARCHAR(100) NOT NULL,MobileNo VARCHAR(10) NOT NULL ,Salary INT NOT NULL,Bonus  DECIMAL (18, 2) DEFAULT 0,AgentID INT NOT NULL AUTO_INCREMENT,SuperID INT DEFAULT NULL,PRIMARY KEY (AgentID),CONSTRAINT UC_AGENT UNIQUE (MobileNo),CHECK (MobileNo RLIKE '^[0-9]{10}$'),FOREIGN KEY (SuperID) REFERENCES AGENT (AgentID) ON DELETE SET NULL ON UPDATE CASCADE);
CREATE TABLE IF NOT EXISTS BANK(BankID INT NOT NULL AUTO_INCREMENT,Name VARCHAR(100) NOT NULL ,BranchAddress varchar(100) NOT NULL UNIQUE,PRIMARY KEY (BankID));
CREATE TABLE IF NOT EXISTS BUYER(Name VARCHAR(100) NOT NULL,MobileNo VARCHAR(10) NOT NULL UNIQUE,Email VARCHAR(100) NOT NULL UNIQUE,CreditScore INT NOT NULL,Address VARCHAR(100) NOT NULL UNIQUE,BankID INT DEFAULT NULL,BuyerID INT NOT NULL AUTO_INCREMENT,PRIMARY KEY (BuyerID),FOREIGN KEY (BankID) REFERENCES BANK(BankID) ON DELETE SET NULL ON UPDATE CASCADE,CHECK (MobileNo RLIKE '^[0-9]{10}$'),CHECK (Email RLIKE '^(?=[A-Z0-9][A-Z0-9@.%+-]{5,253}+$)[A-Z0-9.%+-]{1,64}+@(?:(?=[A-Z0-9-]{1,63}+\.)[A-Z0-9]++(?:-[A-Z0-9]++)*+\.){1,8}+[A-Z]{2,63}+$'),CHECK (CreditScore >= 300 AND CreditScore <= 800));
CREATE TABLE IF NOT EXISTS PROPERTYDEAL(AgentID INT NOT NULL,TransactionID INT NOT NULL AUTO_INCREMENT,BuyerID INT NOT NULL,SellerID INT NOT NULL,PropertyID INT NOT NULL,PRIMARY KEY (TransactionID),FOREIGN KEY (BuyerID) REFERENCES BUYER(BuyerID),FOREIGN KEY (SellerID) REFERENCES SELLER(SellerID),FOREIGN KEY (AgentID) REFERENCES AGENT(AgentID),FOREIGN KEY (PropertyID) REFERENCES PROPERTY(PropertyID));
CREATE TABLE IF NOT EXISTS COMMERCIAL(Floors INT NOT NULL,Type varchar(100) NOT NULL,ParkingSpace INT NOT NULL,YearBuilt INT NOT NULL,PropertyID INT NOT NULL,PRIMARY KEY (PropertyID),FOREIGN KEY (PropertyID) REFERENCES PROPERTY(PropertyID) ON DELETE CASCADE ON UPDATE CASCADE,CHECK (YearBuilt <= 2020 AND YearBuilt >= 1000),CHECK (Type IN ('shop','Shop','office','Office','godown','Godown')));
CREATE TABLE IF NOT EXISTS RESIDENTIAL(ElectricityTime INT NOT NULL,WaterTime INT NOT NULL,CarpetAreaInSqFt  INT NOT NULL,LiftAvailibility varchar(10) NOT NULL,Type varchar(100) NOT NULL,BedRooms INT NOT NULL,ReservedParking INT NOT NULL,PropertyID INT NOT NULL,PRIMARY KEY (PropertyID),FOREIGN KEY (PropertyID) REFERENCES PROPERTY(PropertyID) ON DELETE CASCADE ON UPDATE CASCADE,CHECK (Type IN ('Villa','villa','Flat','flat','Penthouse','penthouse')),CHECK (ElectricityTime >= 0 AND ElectricityTime <= 24),CHECK (WaterTime >= 0 AND WaterTime <= 24),CHECK (LiftAvailibility IN ('Yes','yes','No','no')));
CREATE TABLE IF NOT EXISTS SERVICES(PropertyID INT NOT NULL,ServiceDesc varchar(100) NOT NULL,PRIMARY KEY (PropertyID,ServiceDesc),FOREIGN KEY (PropertyID) REFERENCES COMMERCIAL(PropertyID) ON DELETE CASCADE ON UPDATE CASCADE);
CREATE TABLE IF NOT EXISTS PLOT(FloorsAllowed INT NOT NULL,AreaInAcres  INT NOT NULL,CostPerSqFt  DECIMAL (18, 2) NOT NULL,BoundaryWall varchar(100) NOT NULL,PropertyID INT NOT NULL,PRIMARY KEY (PropertyID),FOREIGN KEY (PropertyID) REFERENCES PROPERTY(PropertyID) ON DELETE CASCADE ON UPDATE CASCADE,CHECK (BoundaryWall IN ('Yes','yes','No','no')));
CREATE TABLE IF NOT EXISTS AREACONVERSION(AreaInSqFt  DECIMAL (18, 2),AreaInAcres INT NOT NULL,PRIMARY KEY (AreaInAcres));
CREATE TABLE IF NOT EXISTS PERSON(PropertyID INT NOT NULL,Name varchar(100) NOT NULL,Gender varchar(100) NOT NULL,Occupation varchar(100) NOT NULL,Remarks varchar(100) NOT NULL,PRIMARY KEY (PropertyID,Name),FOREIGN KEY (PropertyID) REFERENCES PROPERTY(PropertyID) ON DELETE CASCADE ON UPDATE CASCADE,CHECK (Gender IN ('Female', 'Male','male','female')));
CREATE TABLE IF NOT EXISTS DEPENDENT(Age INT NOT NULL,Name varchar(100) NOT NULL,AgentId INT NOT NULL,Gender varchar(100) NOT NULL,Relationship varchar(100) NOT NULL,PRIMARY KEY (Name,AgentId),CHECK (Gender IN ('Female', 'Male','male','female')),CHECK (Age > 0),FOREIGN KEY (AgentID) REFERENCES AGENT(AgentID) ON DELETE CASCADE ON UPDATE CASCADE);
CREATE TABLE IF NOT EXISTS BANKINTEREST(Name VARCHAR(100) NOT NULL,InterestRate DECIMAL (18, 2) NOT NULL,PRIMARY KEY (Name),CHECK (InterestRate <= 100.00 AND InterestRate >= 0.00));
CREATE TABLE IF NOT EXISTS CITYTOSTATE(State varchar(100) NOT NULL,City varchar(100) NOT NULL,PRIMARY KEY (City));
CREATE TABLE IF NOT EXISTS STREETTOPINCODE(Pincode varchar(6) NOT NULL,StreetAddress varchar(100) NOT NULL,PRIMARY KEY (StreetAddress),CHECK (Pincode RLIKE '^[0-9]{6}$'));
CREATE TABLE IF NOT EXISTS PINCODETOCITY(Pincode varchar(6) NOT NULL,City varchar(100) NOT NULL,PRIMARY KEY (Pincode),CHECK (Pincode RLIKE '^[0-9]{6}$'));